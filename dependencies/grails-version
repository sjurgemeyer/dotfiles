GRAILS_CMD=$1
shift
GRAILS_TEMP_DIR="`find . -iname grails-app | grep -Ev 'target|.hg|rabbitmq'`"
if [ "$GRAILS_TEMP_DIR" != '' ]; then
    cd $GRAILS_TEMP_DIR
fi

while [ ! -f 'application.properties' -a ! "`pwd`" == '/' ]; do
    cd ..
done

if [ -f application.properties ]; then
    export GRAILS_VERSION=`grep app.grails.version application.properties | sed -E 's/.*=(.*)/\1/'`
    echo "application.properties found, grails $GRAILS_VERSION"
    gvm use grails $GRAILS_VERSION
else 
    echo "application.properties NOT found, leaving \$GRAILS_HOME as $GRAILS_HOME"
fi
 
if [ ! -d $GRAILS_HOME ]; then
    echo "ERROR: Unable to find \$GRAILS_HOME directory at $GRAILS_HOME"
    exit 1
fi
 
$GRAILS_CMD $*
